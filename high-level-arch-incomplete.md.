# High-Level Architecture: Profile-Constrained LLM Tools (Gemini 3 + Cloudflare D1)

## Purpose

This diagram expresses

### 1. Strict profile‑only LLM behavior

The dashed red constraint arrow shows that Gemini 3 receives a system prompt enforcing:
 • No external search
 • No browsing
 • No tools
 • No hallucinated experience
 • Only use the profile snippets retrieved from D1
 • Decline unrelated questions
This is the core safety boundary.

### 2. Cloudflare D1 as the single source of truth

#### D1 stores

##### Table | Purpose

---------------
ProfileDocuments | Your education, experience, projects
ProfileEmbeddings | Vector embeddings for RAG
Contacts | User identity + email domain classification
Sessions | Session tokens for access control
Conversations | Multi-turn interview sessions
Messages | Chat history

### 3. RAG Engine

The RAG engine retrieves only the relevant profile snippets using:
 • Embedding similarity search
 • Document metadata filters
 • Hard limits on number of retrieved chunks
This ensures the LLM sees only what you want it to see.

### 4. Contact gating + org email filtering

The Auth Service and Email Domain Filter enforce:
 • Collect name, email, org
 • Reject free email domains (gmail, yahoo, etc.)
 • Issue session tokens only for approved users

### 5. Two tools, one architecture

Both the Job Fit Tool and Interview Tool reuse:
 • Session validation
 • RAG retrieval
 • Prompt builder
 • Gemini 3 API
